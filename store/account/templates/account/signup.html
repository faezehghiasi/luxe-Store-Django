{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Sign Up" %} | LUXE{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-white py-4">
                    <div class="text-center">
                        <i class="fas fa-gem text-accent fa-3x mb-3"></i>
                        <h2 class="h4 text-uppercase mb-0">{% trans "Create Account" %}</h2>
                        <p class="text-muted">{% trans "Join the LUXE experience" %}</p>
                    </div>
                </div>
                <div class="card-body p-5">
                    <form method="post" enctype="application/x-www-form-urlencoded">
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                            <div class="alert alert-danger" role="alert">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <!-- Username Field -->
                        <div class="mb-4">
                            <label for="{{ form.username.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Username" %} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-user text-muted"></i>
                                </span>
                                <input type="text"
                                       class="form-control {% if form.username.errors %}is-invalid{% endif %}"
                                       id="{{ form.username.id_for_label }}"
                                       name="{{ form.username.html_name }}"
                                       value="{{ form.username.value|default:'' }}"
                                       required>
                            </div>
                            {% if form.username.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.username.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- First Name Field -->
                        <div class="mb-4">
                            <label for="{{ form.first_name.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "First Name" %}
                            </label>
                            <input type="text"
                                   class="form-control {% if form.first_name.errors %}is-invalid{% endif %}"
                                   id="{{ form.first_name.id_for_label }}"
                                   name="{{ form.first_name.html_name }}"
                                   value="{{ form.first_name.value|default:'' }}">
                            {% if form.first_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.first_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Last Name Field -->
                        <div class="mb-4">
                            <label for="{{ form.last_name.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Last Name" %}
                            </label>
                            <input type="text"
                                   class="form-control {% if form.last_name.errors %}is-invalid{% endif %}"
                                   id="{{ form.last_name.id_for_label }}"
                                   name="{{ form.last_name.html_name }}"
                                   value="{{ form.last_name.value|default:'' }}">
                            {% if form.last_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.last_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Email Field -->
                        <div class="mb-4">
                            <label for="{{ form.email.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Email" %} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-envelope text-muted"></i>
                                </span>
                                <input type="email"
                                       class="form-control {% if form.email.errors %}is-invalid{% endif %}"
                                       id="{{ form.email.id_for_label }}"
                                       name="{{ form.email.html_name }}"
                                       value="{{ form.email.value|default:'' }}"
                                       required>
                            </div>
                            {% if form.email.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Phone Number Field -->
                        <div class="mb-4">
                            <label for="{{ form.phone_number.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Phone Number" %} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-phone text-muted"></i>
                                </span>
                                <input type="tel"
                                       class="form-control {% if form.phone_number.errors %}is-invalid{% endif %}"
                                       id="{{ form.phone_number.id_for_label }}"
                                       name="{{ form.phone_number.html_name }}"
                                       value="{{ form.phone_number.value|default:'' }}"
                                       required>
                            </div>
                            {% if form.phone_number.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.phone_number.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Password Field -->
                        <div class="mb-4">
                            <label for="{{ form.password1.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Password" %} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-lock text-muted"></i>
                                </span>
                                <input type="password"
                                       class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                                       id="{{ form.password1.id_for_label }}"
                                       name="{{ form.password1.html_name }}"
                                       required>
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            {% if form.password1.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.password1.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% else %}
                                    <small class="form-text text-muted">
                                        {% trans "Minimum 8 characters with letters and numbers" %}
                                    </small>
                                {% endif %}
                        </div>

                        <!-- Password Confirmation Field -->
                        <div class="mb-4">
                            <label for="{{ form.password2.id_for_label }}" class="form-label small text-uppercase text-muted">
                                {% trans "Confirm Password" %} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-lock text-muted"></i>
                                </span>
                                <input type="password"
                                       class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                                       id="{{ form.password2.id_for_label }}"
                                       name="{{ form.password2.html_name }}"
                                       required>
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            {% if form.password2.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.password2.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Password Match Validation -->
                        <div id="password-match-error" class="alert alert-danger d-none mb-4">
                            {% trans "Passwords do not match!" %}
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                            {% trans "Create Account" %} <i class="fas fa-user-plus ms-2"></i>
                        </button>

                        <!-- Login Link -->
                        <div class="text-center small text-muted">
                            {% trans "Already have an account?" %} <a href="{% url 'login' %}" class="text-accent">{% trans "Sign in" %}</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
    }
    .form-control:focus {
        box-shadow: none;
        border-color: var(--primary-color);
    }
    .btn-primary {
        background-color: var(--primary-color);
        transition: all 0.3s ease;
    }
    .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
    }
</style>

<script>
    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
            const input = this.closest('.input-group').querySelector('input');
            const icon = this.querySelector('i');
            input.type = input.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        });
    });

    // Password match validation
    const password1 = document.getElementById('{{ form.password1.id_for_label }}');
    const password2 = document.getElementById('{{ form.password2.id_for_label }}');
    const errorDiv = document.getElementById('password-match-error');

    function checkPasswordMatch() {
        if (password1.value && password2.value && password1.value !== password2.value) {
            errorDiv.classList.remove('d-none');
        } else {
            errorDiv.classList.add('d-none');
        }
    }

    password1.addEventListener('input', checkPasswordMatch);
    password2.addEventListener('input', checkPasswordMatch);
</script>
{% endblock %}